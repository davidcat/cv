name: Deploy Resume to GitHub Pages

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Build HTML Resume from Markdown
      run: |
        # 安装pandoc用于转换Markdown到HTML
        sudo apt-get update
        sudo apt-get install -y pandoc

        # 创建HTML文件头部
        echo '<!DOCTYPE html>' > index.html
        echo '<html lang="zh-CN">' >> index.html
        echo '<head>' >> index.html
        echo '<meta charset="UTF-8">' >> index.html
        echo '<meta name="viewport" content="width=device-width, initial-scale=1.0">' >> index.html
        echo '<title>故知 - iOS 开发工程师简历</title>' >> index.html
        echo '<style>' >> index.html
        echo 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #f8f9fa; }' >> index.html
        echo '.container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }' >> index.html
        echo 'header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px solid #e9ecef; }' >> index.html
        echo 'h1 { color: #2c3e50; margin-bottom: 10px; }' >> index.html
        echo '.contact-info p { margin: 5px 0; color: #6c757d; }' >> index.html
        echo '.contact-info a { color: #007bff; text-decoration: none; margin: 0 10px; }' >> index.html
        echo 'section { margin-bottom: 40px; }' >> index.html
        echo 'h2 { color: #2c3e50; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; }' >> index.html
        echo 'h3 { color: #495057; }' >> index.html
        echo '.date { color: #6c757d; font-style: italic; margin-bottom: 15px; }' >> index.html
        echo 'ul { margin-bottom: 20px; padding-left: 20px; }' >> index.html
        echo 'li { margin-bottom: 8px; }' >> index.html
        echo 'strong { color: #2c3e50; }' >> index.html
        echo 'footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e9ecef; color: #6c757d; }' >> index.html
        echo '.code-block { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 5px; padding: 15px; margin: 10px 0; font-family: "Courier New", monospace; font-size: 14px; overflow-x: auto; }' >> index.html
        echo '.highlight { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 3px; padding: 10px; }' >> index.html
        echo '.emoji { font-size: 1.2em; }' >> index.html
        echo '</style>' >> index.html
        echo '</head>' >> index.html
        echo '<body>' >> index.html
        echo '<div class="container">' >> index.html

        # 转换Markdown到HTML
        pandoc 故知-iOS.md -f markdown -t html --ascii >> index.html

        echo '</div>' >> index.html
        echo '</body>' >> index.html
        echo '</html>' >> index.html

    - name: Upload Pages artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4